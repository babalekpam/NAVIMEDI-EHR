import{u as f,au as v,c as w,j as e,dc as t,C as r,d as l,g as d,e as c,f as x,bQ as k,an as C,t as i,h as P,cX as S,a1 as n,ap as u,aq as I,cg as B}from"./index-B4rk5nfq.js";function M(){const{toast:p}=f(),{data:s,isLoading:j}=v({queryKey:["/api/tenant/current"]}),o=w({mutationFn:async()=>await B("/api/create-billing-portal-session",{method:"POST"}),onSuccess:a=>{a.url&&(window.location.href=a.url)},onError:a=>{p({title:"Error",description:a.message||"Failed to open billing portal",variant:"destructive"})}}),b=()=>{o.mutate()},g=a=>{switch(a){case"active":return e.jsxs(n,{className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100","data-testid":"badge-status-active",children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),"Active"]});case"trial":return e.jsxs(n,{className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100","data-testid":"badge-status-trial",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),"Trial"]});case"cancelled":return e.jsxs(n,{className:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100","data-testid":"badge-status-cancelled",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Cancelled"]});case"suspended":return e.jsxs(n,{className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100","data-testid":"badge-status-suspended",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Suspended"]});default:return e.jsx(n,{variant:"secondary","data-testid":"badge-status-unknown",children:a})}},y=a=>({starter:"Starter",professional:"Professional",enterprise:"Enterprise",white_label:"White Label"})[a]||a,N=(a,h)=>{const m={starter:{monthly:49.99,yearly:510.99},professional:{monthly:119.99,yearly:1210.99},enterprise:{monthly:319.99,yearly:3210.99},white_label:{monthly:1019.99,yearly:10210.99}}[a];return m?h==="yearly"?m.yearly:m.monthly:0};return j?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(t,{className:"h-12 w-64 mb-2"}),e.jsx(t,{className:"h-6 w-96 mb-8"}),e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(t,{className:"h-8 w-48"}),e.jsx(t,{className:"h-4 w-64"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsx(t,{className:"h-24 w-full"}),e.jsx(t,{className:"h-24 w-full"}),e.jsx(t,{className:"h-12 w-full"})]})]})]})}):s?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2","data-testid":"heading-billing",children:"Billing & Subscription"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Manage your subscription, payment methods, and billing history"})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(r,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Current Plan"]}),e.jsx(x,{children:"Your active subscription plan"})]}),g(s.subscriptionStatus)]})}),e.jsxs(d,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Plan"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-plan-name",children:s.subscriptionPlanId?y(s.subscriptionPlanId):"Trial"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Billing Cycle"}),e.jsx("p",{className:"text-2xl font-bold","data-testid":"text-billing-cycle",children:s.subscriptionInterval==="yearly"?"Yearly":s.subscriptionInterval==="monthly"?"Monthly":"Trial"})]})]}),s.subscriptionPlanId&&s.subscriptionInterval&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Amount"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400","data-testid":"text-amount",children:["$",N(s.subscriptionPlanId,s.subscriptionInterval)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Per"}),e.jsx("p",{className:"text-lg font-medium",children:s.subscriptionInterval==="yearly"?"Year":"Month"})]})]})}),s.subscriptionStatus==="trial"&&s.trialEndDate&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("p",{className:"text-sm","data-testid":"text-trial-end",children:["Trial ends on ",new Date(s.trialEndDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]})})]})]}),e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(c,{children:"Manage Subscription"}),e.jsx(x,{children:"Update payment methods, view invoices, and manage your subscription"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Stripe Customer Portal"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200 mb-4",children:"Access the secure Stripe portal to:"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 mb-4",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"Update payment methods"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"View and download invoices"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"Update billing information"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"w-4 h-4"}),"Cancel subscription (if needed)"]})]})]}),e.jsx(P,{onClick:b,disabled:!s.stripeCustomerId||o.isPending,className:"w-full",size:"lg","data-testid":"button-open-portal",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"}),"Opening Portal..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Open Billing Portal"]})}),!s.stripeCustomerId&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center","data-testid":"text-no-subscription",children:"No active subscription found. Please subscribe to a plan to access the billing portal."})]})})]}),e.jsxs(r,{children:[e.jsxs(l,{children:[e.jsx(c,{children:"Organization Details"}),e.jsx(x,{children:"Your organization information"})]}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Organization Name"}),e.jsx("p",{className:"font-medium","data-testid":"text-org-name",children:s.name})]}),s.stripeCustomerId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Customer ID"}),e.jsx("p",{className:"font-mono text-sm text-gray-700 dark:text-gray-300","data-testid":"text-customer-id",children:s.stripeCustomerId})]})]})})]})]})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx(r,{children:e.jsxs(l,{children:[e.jsx(c,{children:"No Subscription Found"}),e.jsx(x,{children:"Unable to load your subscription details. Please contact support if this issue persists."})]})})})})}export{M as default};
