import{r as P,u as G,at as X,a as Y,b as _,c as ee,au as se,j as e,a6 as te,cG as re,h as j,P as ie,a7 as ae,a8 as le,a9 as ne,aa as de,F as ce,i as r,k as i,l as a,m as l,I as c,n,N as O,O as T,Q as B,V,W as p,T as k,C as u,d as f,e as v,U as w,g as y,cD as z,an as oe,f as he,X as xe,Y as me,Z as L,_ as h,$ as je,a0 as x,bT as pe,bV as ue,bJ as S,bK as M,bG as fe,M as ve,ai as ye,av as Ne,cF as d,aw as D,cg as ge}from"./index-B4rk5nfq.js";const Ce=Ne({firstName:d().min(1,"First name is required"),lastName:d().min(1,"Last name is required"),email:d().email("Please enter a valid email address"),phone:d().min(10,"Please enter a valid phone number"),dateOfBirth:d().min(1,"Date of birth is required"),street:d().min(1,"Street address is required"),city:d().min(1,"City is required"),state:d().min(1,"State is required"),zipCode:d().min(5,"ZIP code is required"),preferredFulfillmentMethod:D(["pickup","delivery"]).default("pickup"),deliveryStreet:d().optional(),deliveryCity:d().optional(),deliveryState:d().optional(),deliveryZipCode:d().optional(),deliveryInstructions:d().optional(),insuranceProvider:d().optional(),preferredContactMethod:D(["email","phone","sms"]).default("email"),allergies:d().optional(),notes:d().optional()});function we(){const[N,q]=P.useState("");P.useState(null);const[E,C]=P.useState(!1),{toast:A}=G(),H=X(),t=Y({resolver:_(Ce),defaultValues:{firstName:"",lastName:"",email:"",phone:"",dateOfBirth:"",street:"",city:"",state:"",zipCode:"",preferredFulfillmentMethod:"pickup",deliveryStreet:"",deliveryCity:"",deliveryState:"",deliveryZipCode:"",deliveryInstructions:"",insuranceProvider:"",preferredContactMethod:"email",allergies:"",notes:""}}),b=ee({mutationFn:async s=>{const o=s.preferredFulfillmentMethod==="delivery"&&s.deliveryStreet?{street:s.deliveryStreet,city:s.deliveryCity||"",state:s.deliveryState||"",zipCode:s.deliveryZipCode||""}:null,m={firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone,dateOfBirth:s.dateOfBirth,address:{street:s.street,city:s.city,state:s.state,zipCode:s.zipCode},deliveryAddress:o,emergencyContact:null,insuranceInfo:s.insuranceProvider?{provider:s.insuranceProvider}:null,allergies:s.allergies?s.allergies.split(",").map(U=>U.trim()):[],medicalHistory:[],medications:[],preferredContactMethod:s.preferredContactMethod,preferredFulfillmentMethod:s.preferredFulfillmentMethod,deliveryInstructions:s.deliveryInstructions,notes:s.notes};return ge("/api/patients",{method:"POST",body:JSON.stringify(m)})},onSuccess:()=>{H.invalidateQueries({queryKey:["/api/patients"]}),C(!1),t.reset(),A({title:"Customer Added",description:"New customer has been successfully added to your system."})},onError:s=>{A({title:"Error",description:s.message||"Failed to add customer. Please try again.",variant:"destructive"})}}),$=s=>{b.mutate(s)},{data:Z=[],isLoading:be}=se({queryKey:["/api/patients"],staleTime:3e4}),I=Z.map(s=>{let o="";if(s.insuranceInfo)try{if(typeof s.insuranceInfo=="object")o=s.insuranceInfo.provider||s.insuranceInfo.manualProvider||"";else if(typeof s.insuranceInfo=="string"){const m=JSON.parse(s.insuranceInfo);o=m.provider||m.manualProvider||""}console.log(`Insurance for ${s.firstName} ${s.lastName}:`,o)}catch{console.warn(`Failed to parse insurance for ${s.firstName} ${s.lastName}:`,s.insuranceInfo),o=""}return{id:s.id,firstName:s.firstName,lastName:s.lastName,email:s.email||"",phone:s.phone||"",dateOfBirth:s.dateOfBirth,address:s.address||{street:"",city:"",state:"",zipCode:""},deliveryAddress:s.deliveryAddress,insuranceProvider:o,totalPrescriptions:0,activePrescriptions:0,lastVisit:s.updatedAt||s.createdAt,preferredContactMethod:s.preferredContactMethod||"email",preferredFulfillmentMethod:s.preferredFulfillmentMethod||"pickup",deliveryInstructions:s.deliveryInstructions,allergies:Array.isArray(s.allergies)?s.allergies:[],notes:s.notes||""}}),g=I.length>0?I:[{id:"1",firstName:"John",lastName:"Doe",email:"john.doe@email.com",phone:"+1-555-0123",dateOfBirth:"1980-05-15",address:{street:"123 Main St",city:"Healthcare City",state:"CA",zipCode:"90210"},insuranceProvider:"Blue Cross Blue Shield",totalPrescriptions:24,activePrescriptions:3,lastVisit:"2025-01-25",preferredContactMethod:"email",allergies:["Penicillin","Shellfish"],notes:"Prefers generic medications when available"},{id:"2",firstName:"Jane",lastName:"Smith",email:"jane.smith@email.com",phone:"+1-555-0456",dateOfBirth:"1975-12-08",address:{street:"456 Oak Avenue",city:"Medical District",state:"NY",zipCode:"10001"},insuranceProvider:"Aetna",totalPrescriptions:18,activePrescriptions:2,lastVisit:"2025-01-28",preferredContactMethod:"phone",allergies:["Sulfa drugs"],notes:"Diabetic - monitor blood sugar medications"},{id:"3",firstName:"Mike",lastName:"Johnson",email:"mike.johnson@email.com",phone:"+1-555-0789",dateOfBirth:"1965-09-22",address:{street:"789 Pine Street",city:"Health Valley",state:"TX",zipCode:"75001"},insuranceProvider:"UnitedHealth",totalPrescriptions:45,activePrescriptions:5,lastVisit:"2025-01-20",preferredContactMethod:"sms",allergies:[],notes:"Regular customer - hypertension management"},{id:"4",firstName:"Sarah",lastName:"Davis",email:"sarah.davis@email.com",phone:"+1-555-0321",dateOfBirth:"1990-03-11",address:{street:"321 Elm Drive",city:"Wellness Town",state:"FL",zipCode:"33101"},insuranceProvider:"Humana",totalPrescriptions:8,activePrescriptions:1,lastVisit:"2025-01-15",preferredContactMethod:"email",allergies:["Latex"],notes:"New mother - postpartum medications"},{id:"5",firstName:"Robert",lastName:"Wilson",email:"robert.wilson@email.com",phone:"+1-555-0654",dateOfBirth:"1955-07-30",address:{street:"654 Maple Lane",city:"Care City",state:"WA",zipCode:"98101"},insuranceProvider:"Medicare",totalPrescriptions:67,activePrescriptions:8,lastVisit:"2025-01-29",preferredContactMethod:"phone",allergies:["NSAIDs","Aspirin"],notes:"Senior patient - multiple chronic conditions"}],F=g.filter(s=>`${s.firstName} ${s.lastName}`.toLowerCase().includes(N.toLowerCase())||s.email.toLowerCase().includes(N.toLowerCase())||s.phone.includes(N)),J=(s,o)=>`${s.charAt(0)}${o.charAt(0)}`.toUpperCase(),Q=s=>{switch(s){case"email":return e.jsx(S,{className:"h-4 w-4"});case"phone":return e.jsx(M,{className:"h-4 w-4"});case"sms":return e.jsx(M,{className:"h-4 w-4"});default:return e.jsx(S,{className:"h-4 w-4"})}},R=g.length,W=g.filter(s=>s.activePrescriptions>0).length,K=g.reduce((s,o)=>s+o.activePrescriptions,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Customer Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage pharmacy customer profiles and prescription history"})]}),e.jsxs(te,{open:E,onOpenChange:C,children:[e.jsx(re,{asChild:!0,children:e.jsxs(j,{className:"flex items-center gap-2","data-testid":"button-add-customer",children:[e.jsx(ie,{className:"h-4 w-4"}),"Add New Customer"]})}),e.jsxs(ae,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Add New Customer"}),e.jsx(de,{children:"Create a new customer account for your pharmacy"})]}),e.jsx(ce,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit($),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{control:t.control,name:"firstName",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"First Name"}),e.jsx(l,{children:e.jsx(c,{placeholder:"Enter first name",...s,"data-testid":"input-first-name"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"lastName",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Last Name"}),e.jsx(l,{children:e.jsx(c,{placeholder:"Enter last name",...s,"data-testid":"input-last-name"})}),e.jsx(n,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{control:t.control,name:"email",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Email"}),e.jsx(l,{children:e.jsx(c,{type:"email",placeholder:"Enter email address",...s,"data-testid":"input-email"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"phone",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Phone Number"}),e.jsx(l,{children:e.jsx(c,{placeholder:"(555) 123-4567",...s,"data-testid":"input-phone"})}),e.jsx(n,{})]})})]}),e.jsx(r,{control:t.control,name:"dateOfBirth",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Date of Birth"}),e.jsx(l,{children:e.jsx(c,{type:"date",...s,"data-testid":"input-date-of-birth"})}),e.jsx(n,{})]})}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Address Information"}),e.jsx(r,{control:t.control,name:"street",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Street Address"}),e.jsx(l,{children:e.jsx(c,{placeholder:"123 Main Street",...s,"data-testid":"input-street"})}),e.jsx(n,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsx(r,{control:t.control,name:"city",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"City"}),e.jsx(l,{children:e.jsx(c,{placeholder:"City",...s,"data-testid":"input-city"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"state",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"State"}),e.jsx(l,{children:e.jsx(c,{placeholder:"State",...s,"data-testid":"input-state"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"zipCode",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"ZIP Code"}),e.jsx(l,{children:e.jsx(c,{placeholder:"12345",...s,"data-testid":"input-zip-code"})}),e.jsx(n,{})]})})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"ðŸšš Delivery & Pickup Options"}),e.jsx(r,{control:t.control,name:"preferredFulfillmentMethod",render:({field:s})=>e.jsxs(i,{className:"mb-4",children:[e.jsx(a,{children:"Preferred Fulfillment Method"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,"data-testid":"select-fulfillment-method",children:[e.jsx(l,{children:e.jsx(T,{children:e.jsx(B,{placeholder:"Select fulfillment method"})})}),e.jsxs(V,{children:[e.jsx(p,{value:"pickup",children:"Pickup at Pharmacy"}),e.jsx(p,{value:"delivery",children:"Home Delivery"})]})]}),e.jsx(n,{})]})}),t.watch("preferredFulfillmentMethod")==="delivery"&&e.jsxs("div",{className:"space-y-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h5",{className:"font-medium text-blue-800",children:"Delivery Address"}),e.jsx("p",{className:"text-sm text-blue-600",children:"Leave blank to use main address for delivery"}),e.jsx(r,{control:t.control,name:"deliveryStreet",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Delivery Street Address (Optional)"}),e.jsx(l,{children:e.jsx(c,{placeholder:"123 Delivery Street (leave blank to use main address)",...s,"data-testid":"input-delivery-street"})}),e.jsx(n,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(r,{control:t.control,name:"deliveryCity",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Delivery City"}),e.jsx(l,{children:e.jsx(c,{placeholder:"City",...s,"data-testid":"input-delivery-city"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"deliveryState",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Delivery State"}),e.jsx(l,{children:e.jsx(c,{placeholder:"State",...s,"data-testid":"input-delivery-state"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"deliveryZipCode",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Delivery ZIP"}),e.jsx(l,{children:e.jsx(c,{placeholder:"12345",...s,"data-testid":"input-delivery-zip"})}),e.jsx(n,{})]})})]}),e.jsx(r,{control:t.control,name:"deliveryInstructions",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Delivery Instructions (Optional)"}),e.jsx(l,{children:e.jsx(k,{placeholder:"Special delivery instructions (gate code, apartment number, etc.)",className:"min-h-[60px]",...s,"data-testid":"input-delivery-instructions"})}),e.jsx(n,{})]})})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Additional Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(r,{control:t.control,name:"insuranceProvider",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Insurance Provider (Optional)"}),e.jsx(l,{children:e.jsx(c,{placeholder:"Blue Cross, Aetna, etc.",...s,"data-testid":"input-insurance"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"preferredContactMethod",render:({field:s})=>e.jsxs(i,{children:[e.jsx(a,{children:"Preferred Contact Method"}),e.jsxs(O,{onValueChange:s.onChange,defaultValue:s.value,"data-testid":"select-contact-method",children:[e.jsx(l,{children:e.jsx(T,{children:e.jsx(B,{placeholder:"Select contact method"})})}),e.jsxs(V,{children:[e.jsx(p,{value:"email",children:"Email"}),e.jsx(p,{value:"phone",children:"Phone"}),e.jsx(p,{value:"sms",children:"SMS"})]})]}),e.jsx(n,{})]})})]}),e.jsx(r,{control:t.control,name:"allergies",render:({field:s})=>e.jsxs(i,{className:"mt-4",children:[e.jsx(a,{children:"Known Allergies (Optional)"}),e.jsx(l,{children:e.jsx(c,{placeholder:"Penicillin, Shellfish, etc. (comma separated)",...s,"data-testid":"input-allergies"})}),e.jsx(n,{})]})}),e.jsx(r,{control:t.control,name:"notes",render:({field:s})=>e.jsxs(i,{className:"mt-4",children:[e.jsx(a,{children:"Notes (Optional)"}),e.jsx(l,{children:e.jsx(k,{placeholder:"Any additional notes about this customer",className:"min-h-[80px]",...s,"data-testid":"input-notes"})}),e.jsx(n,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>C(!1),"data-testid":"button-cancel",children:"Cancel"}),e.jsx(j,{type:"submit",disabled:b.isPending,"data-testid":"button-submit-customer",children:b.isPending?"Adding...":"Add Customer"})]})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total Customers"}),e.jsx(w,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:R}),e.jsx("p",{className:"text-xs text-gray-500",children:"Registered patients"})]})]}),e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Active Customers"}),e.jsx(w,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:W}),e.jsx("p",{className:"text-xs text-gray-500",children:"With active prescriptions"})]})]}),e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Active Prescriptions"}),e.jsx(z,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:K}),e.jsx("p",{className:"text-xs text-gray-500",children:"Currently being filled"})]})]}),e.jsxs(u,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"New This Month"}),e.jsx(oe,{className:"h-4 w-4 text-orange-600"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"12"}),e.jsx("p",{className:"text-xs text-gray-500",children:"New registrations"})]})]})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Customer Directory"}),e.jsx(he,{children:"View and manage customer information"})]}),e.jsx("div",{className:"relative w-80",children:e.jsx(c,{placeholder:"Search customers...",value:N,onChange:s=>q(s.target.value),className:"w-full"})})]})}),e.jsxs(y,{children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(L,{children:[e.jsx(h,{children:"Customer"}),e.jsx(h,{children:"Contact"}),e.jsx(h,{children:"Fulfillment"}),e.jsx(h,{children:"Insurance"}),e.jsx(h,{children:"Prescriptions"}),e.jsx(h,{children:"Last Visit"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(je,{children:F.map(s=>e.jsxs(L,{className:"cursor-pointer hover:bg-gray-50",children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"h-10 w-10",children:e.jsx(ue,{className:"bg-blue-100 text-blue-800 font-medium",children:J(s.firstName,s.lastName)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["DOB: ",new Date(s.dateOfBirth).toLocaleDateString()]}),s.allergies.length>0&&e.jsxs("div",{className:"text-xs text-red-600",children:["Allergies: ",s.allergies.join(", ")]})]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(S,{className:"h-3 w-3 text-gray-400"}),s.email]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{className:"h-3 w-3 text-gray-400"}),s.phone]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[Q(s.preferredContactMethod),"Prefers ",s.preferredContactMethod]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm",children:s.preferredFulfillmentMethod==="delivery"?e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{className:"text-blue-600 font-medium",children:"Delivery"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-green-600 font-medium",children:"Pickup"})]})}),s.preferredFulfillmentMethod==="delivery"&&s.deliveryAddress&&e.jsx("div",{className:"text-xs text-gray-500",children:s.deliveryAddress.street}),s.deliveryInstructions&&e.jsxs("div",{className:"text-xs text-gray-500 italic",children:[s.deliveryInstructions.substring(0,30),s.deliveryInstructions.length>30?"...":""]})]})}),e.jsx(x,{children:e.jsx("div",{className:"text-sm",children:s.insuranceProvider||"No insurance"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"text-sm font-medium",children:[s.activePrescriptions," active"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.totalPrescriptions," total"]})]})}),e.jsx(x,{children:e.jsx("div",{className:"text-sm",children:new Date(s.lastVisit).toLocaleDateString()})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(z,{className:"h-4 w-4"})})]})})]},s.id))})]})}),F.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(w,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No customers found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria"})]})]})]})]})}export{we as default};
