import{r as o,u as g,cg as w,j as r,C as j,d as v,e as S,f as N,d7 as k,d6 as E,d8 as C,d9 as I,a1 as L,g as D,cf as F,da as U,h as B}from"./index-QVGfb-Vm.js";const b=E("pk_live_51IGTenIOOGo5yxk3MsJtzIZrryk7cjsYdlxt3IOndCNUnAcgkyf4vUHEOxDF6tZg5rYHN9cam5uYYkuaJdfFIke800vrpXeFMZ"),G=({selectedPlan:s})=>{const c=C(),m=I(),{toast:e}=g(),[l,i]=o.useState(!1),p=async u=>{if(u.preventDefault(),!c||!m)return;i(!0);const{error:a}=await c.confirmPayment({elements:m,confirmParams:{return_url:window.location.origin+"/subscription-success"}});i(!1),e(a?{title:"Subscription Failed",description:a.message,variant:"destructive"}:{title:"Subscription Successful",description:"Welcome to NaviMED Healthcare Platform!"})};return r.jsxs(j,{className:"w-full max-w-md mx-auto",children:[r.jsxs(v,{children:[r.jsxs(S,{className:"flex items-center gap-2",children:["Subscribe to NaviMED ",s==null?void 0:s.name,r.jsxs(L,{variant:"secondary",children:["$",s==null?void 0:s.price,"/",(s==null?void 0:s.interval)==="yearly"?"year":"month"]})]}),r.jsxs(N,{children:[s==null?void 0:s.description,(s==null?void 0:s.savings)&&r.jsxs("span",{className:"block text-emerald-600 font-medium mt-1",children:["Save ",s.savings," with yearly billing"]})]})]}),r.jsxs(D,{children:[r.jsx("div",{className:"space-y-4 mb-6",children:r.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[r.jsxs("p",{className:"font-medium mb-3",children:[s==null?void 0:s.name," plan includes:"]}),r.jsx("ul",{className:"space-y-2",children:s==null?void 0:s.features.map((u,a)=>r.jsxs("li",{className:"flex items-center gap-2",children:[r.jsx(F,{className:"w-4 h-4 text-green-500"}),r.jsx("span",{children:u})]},a))})]})}),r.jsxs("form",{onSubmit:p,className:"space-y-4",children:[r.jsx(U,{}),r.jsx(B,{type:"submit",disabled:!c||l,className:"w-full","data-testid":"button-subscribe",children:l?"Processing...":"Subscribe Now"})]})]})]})};function M(){const[s,c]=o.useState(""),[m,e]=o.useState(!0),[l,i]=o.useState(""),[p,u]=o.useState(null),{toast:a}=g(),x={starter:{name:"Starter",monthlyPrice:49.99,yearlyPrice:510.99,description:"Perfect for small clinics and practices",features:["5 users","100 patients","1GB storage","Basic support"]},professional:{name:"Professional",monthlyPrice:119.99,yearlyPrice:1210.99,description:"Ideal for growing healthcare organizations",features:["25 users","1000 patients","10GB storage","Advanced reports","Priority support"]},enterprise:{name:"Enterprise",monthlyPrice:319.99,yearlyPrice:3210.99,description:"For large hospitals and health systems",features:["100 users","10000 patients","100GB storage","Custom integrations","24/7 support"]},white_label:{name:"White Label",monthlyPrice:1019.99,yearlyPrice:10210.99,description:"Full customization and branding control",features:["Unlimited users","Unlimited patients","Unlimited storage","White label branding","Dedicated support"]}},f=new URLSearchParams(window.location.search),t=f.get("plan")||"professional",n=f.get("interval")||"monthly",y=!!b;return o.useEffect(()=>{if(!y){i("Stripe subscription processing is not configured. Please contact administrator."),e(!1);return}if(!x[t]){i(`Invalid plan selected: ${t}. Please go back and select a valid plan.`),e(!1);return}const h=x[t];u({...h,id:t,interval:n,price:n==="yearly"?h.yearlyPrice:h.monthlyPrice,savings:n==="yearly"?"17%":null}),w("/api/get-or-create-subscription",{method:"POST",body:{planId:t,interval:n}}).then(d=>{console.log("âœ… Subscription created for plan:",t,"interval:",n,"amount:",d.amount),c(d.clientSecret),e(!1)}).catch(d=>{console.error("Subscription error:",d),i("Subscription processing is currently unavailable. Please try again later."),e(!1),a({title:"Subscription Setup Error",description:"Subscription processing is currently unavailable",variant:"destructive"})})},[a,y,t,n]),m?r.jsx("div",{className:"h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full","aria-label":"Loading"})}):l?r.jsx("div",{className:"h-screen flex items-center justify-center",children:r.jsx(j,{className:"w-full max-w-md mx-auto",children:r.jsxs(v,{children:[r.jsx(S,{children:"Subscription Unavailable"}),r.jsx(N,{children:l})]})})}):s?r.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12",children:r.jsxs("div",{className:"container mx-auto px-4",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"NaviMED Healthcare Subscription"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Join thousands of healthcare professionals using our platform"})]}),r.jsx(k,{stripe:b,options:{clientSecret:s},children:r.jsx(G,{selectedPlan:p})})]})}):r.jsx("div",{className:"h-screen flex items-center justify-center",children:r.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full","aria-label":"Loading"})})}export{M as default};
