import{w as O,u as E,r as N,au as Q,j as e,s as H,h as D,aC as B,C as p,d as x,e as m,d4 as S,g as h,an as U,bn as W,c_ as y,ab as t,K as z,I as Y,N as _,O as K,Q as G,V as X,W as f,f as Z,X as J,Y as ee,Z as A,_ as d,$ as se,a0 as o,a1 as ae,ai as te,a6 as ie,a7 as re,a8 as ne,a9 as ce,aa as le}from"./index-QVGfb-Vm.js";function oe(){var P;const{tenant:r}=O(),{toast:$}=E(),[j,I]=N.useState(""),[v,L]=N.useState("all"),[a,k]=N.useState(null),[R,b]=N.useState(!1),{data:u=[],isLoading:F}=Q({queryKey:["/api/pharmacy/prescription-archives",r==null?void 0:r.id],enabled:!!(r!=null&&r.id)&&(r==null?void 0:r.type)==="pharmacy"}),g=u.filter(s=>{const i=s.prescriptionData.medicationName.toLowerCase().includes(j.toLowerCase())||s.patientData.name.toLowerCase().includes(j.toLowerCase())||s.receiptData.claimNumber.toLowerCase().includes(j.toLowerCase())||s.receiptData.transactionId.toLowerCase().includes(j.toLowerCase());let c=!0;if(v!=="all"){const w=new Date(s.archivedAt),l=Math.floor((new Date().getTime()-w.getTime())/(1e3*60*60*24));switch(v){case"today":c=l===0;break;case"week":c=l<=7;break;case"month":c=l<=30;break;case"quarter":c=l<=90;break}}return i&&c}),M=s=>{k(s),b(!0)},T=s=>{const i=window.open("","_blank");i&&(i.document.write(`
        <html>
          <head>
            <title>Prescription Receipt - ${s.receiptData.claimNumber}</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; }
              .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; }
              .field { margin: 8px 0; }
              .total { font-weight: bold; border-top: 1px solid #000; padding-top: 8px; margin-top: 15px; }
            </style>
          </head>
          <body>
            <div class="header">
              <h2>${r==null?void 0:r.name}</h2>
              <p>Prescription Receipt</p>
            </div>
            
            <div class="field"><strong>Patient:</strong> ${s.patientData.name}</div>
            <div class="field"><strong>Medication:</strong> ${s.prescriptionData.medicationName}</div>
            <div class="field"><strong>Dosage:</strong> ${s.prescriptionData.dosage}</div>
            <div class="field"><strong>Quantity:</strong> ${s.prescriptionData.quantity}</div>
            <div class="field"><strong>Instructions:</strong> ${s.prescriptionData.instructions}</div>
            
            <div class="field"><strong>Claim Number:</strong> ${s.receiptData.claimNumber}</div>
            <div class="field"><strong>Transaction ID:</strong> ${s.receiptData.transactionId}</div>
            <div class="field"><strong>Dispensed:</strong> ${new Date(s.receiptData.dispensedAt).toLocaleString()}</div>
            
            ${s.prescriptionData.insuranceProvider?`
              <div class="field"><strong>Insurance:</strong> ${s.prescriptionData.insuranceProvider}</div>
              <div class="field"><strong>Coverage:</strong> ${s.prescriptionData.insuranceCoveragePercentage}%</div>
              <div class="field"><strong>Copay:</strong> $${s.prescriptionData.insuranceCopay}</div>
            `:""}
            
            <div class="total">
              <div class="field"><strong>Total Cost:</strong> $${s.prescriptionData.totalCost||"0.00"}</div>
            </div>
            
            <div style="margin-top: 20px; font-size: 10px; text-align: center; border-top: 1px solid #000; padding-top: 8px;">
              ${r==null?void 0:r.name} - HIPAA Compliant<br>
              NaviMED Platform Connected Pharmacy
            </div>
          </body>
        </html>
      `),i.document.close(),i.print())},q=()=>{const s=["Claim Number","Transaction ID","Patient Name","Medication","Dosage","Quantity","Insurance Provider","Copay","Total Cost","Dispensed Date","Archived Date"],i=g.map(n=>[n.receiptData.claimNumber,n.receiptData.transactionId,n.patientData.name,n.prescriptionData.medicationName,n.prescriptionData.dosage,n.prescriptionData.quantity,n.prescriptionData.insuranceProvider||"N/A",n.prescriptionData.insuranceCopay||"0.00",n.prescriptionData.totalCost||"0.00",new Date(n.receiptData.dispensedAt).toLocaleString(),new Date(n.archivedAt).toLocaleString()]),c=[s,...i].map(n=>n.map(V=>`"${V}"`).join(",")).join(`
`),w=new Blob([c],{type:"text/csv"}),C=window.URL.createObjectURL(w),l=document.createElement("a");l.href=C,l.download=`prescription-archives-${new Date().toISOString().split("T")[0]}.csv`,l.click(),window.URL.revokeObjectURL(C),$({title:"Export Complete",description:"Prescription archives exported to CSV successfully"})};return F?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{children:"Loading archived prescriptions..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Prescription Archives"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"View and manage dispensed prescription records for bookkeeping"})]}),e.jsxs(D,{onClick:q,disabled:g.length===0,children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Export to CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(p,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Archived"}),e.jsx(S,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dispensed prescriptions"})]})]}),e.jsxs(p,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"This Month"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.filter(s=>{const i=new Date(s.archivedAt),c=new Date;return i.getMonth()===c.getMonth()&&i.getFullYear()===c.getFullYear()}).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Prescriptions dispensed"})]})]}),e.jsxs(p,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Revenue Generated"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",u.reduce((s,i)=>s+(i.prescriptionData.totalCost||0),0).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total from archived prescriptions"})]})]}),e.jsxs(p,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Insurance Claims"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:u.filter(s=>s.prescriptionData.insuranceProvider).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"With insurance coverage"})]})]})]}),e.jsxs(p,{children:[e.jsx(x,{children:e.jsx(m,{children:"Search & Filter Archives"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(t,{htmlFor:"search",children:"Search Archives"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(Y,{id:"search",placeholder:"Search by medication, patient, claim number, or transaction ID...",value:j,onChange:s=>I(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"w-48",children:[e.jsx(t,{htmlFor:"date-filter",children:"Filter by Date"}),e.jsxs(_,{value:v,onValueChange:L,children:[e.jsx(K,{children:e.jsx(G,{placeholder:"All Dates"})}),e.jsxs(X,{children:[e.jsx(f,{value:"all",children:"All Time"}),e.jsx(f,{value:"today",children:"Today"}),e.jsx(f,{value:"week",children:"This Week"}),e.jsx(f,{value:"month",children:"This Month"}),e.jsx(f,{value:"quarter",children:"This Quarter"})]})]})]})]})})]}),e.jsxs(p,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Archived Prescriptions"}),e.jsxs(Z,{children:[g.length," record(s) found"]})]}),e.jsx(h,{children:g.length>0?e.jsxs(J,{children:[e.jsx(ee,{children:e.jsxs(A,{children:[e.jsx(d,{children:"Claim Number"}),e.jsx(d,{children:"Patient"}),e.jsx(d,{children:"Medication"}),e.jsx(d,{children:"Dosage"}),e.jsx(d,{children:"Insurance"}),e.jsx(d,{children:"Total Cost"}),e.jsx(d,{children:"Dispensed Date"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(se,{children:g.map(s=>{var i;return e.jsxs(A,{children:[e.jsx(o,{className:"font-medium",children:s.receiptData.claimNumber}),e.jsx(o,{children:s.patientData.name}),e.jsx(o,{children:s.prescriptionData.medicationName}),e.jsx(o,{children:s.prescriptionData.dosage}),e.jsx(o,{children:s.prescriptionData.insuranceProvider?e.jsx(ae,{variant:"secondary",children:s.prescriptionData.insuranceProvider}):e.jsx("span",{className:"text-gray-500",children:"Cash"})}),e.jsxs(o,{children:["$",((i=s.prescriptionData.totalCost)==null?void 0:i.toFixed(2))||"0.00"]}),e.jsx(o,{children:new Date(s.receiptData.dispensedAt).toLocaleDateString()}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>M(s),children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Details"]}),e.jsxs(D,{size:"sm",variant:"outline",onClick:()=>T(s),children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),"Receipt"]})]})})]},s.id)})})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(S,{className:"mx-auto h-8 w-8 mb-2"}),e.jsx("p",{children:"No archived prescriptions found"}),e.jsx("p",{className:"text-sm",children:"Dispensed prescriptions will appear here"})]})})]}),e.jsx(ie,{open:R,onOpenChange:b,children:e.jsxs(re,{className:"max-w-2xl",children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Prescription Archive Details"}),e.jsxs(le,{children:["Complete record for ",a==null?void 0:a.receiptData.claimNumber]})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Patient Name"}),e.jsx("p",{children:a.patientData.name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Medication"}),e.jsx("p",{children:a.prescriptionData.medicationName})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Dosage"}),e.jsx("p",{children:a.prescriptionData.dosage})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Frequency"}),e.jsx("p",{children:a.prescriptionData.frequency})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Quantity"}),e.jsx("p",{children:a.prescriptionData.quantity})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Refills"}),e.jsx("p",{children:a.prescriptionData.refills})]})]}),a.prescriptionData.instructions&&e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.prescriptionData.instructions})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Transaction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Claim Number"}),e.jsx("p",{children:a.receiptData.claimNumber})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Transaction ID"}),e.jsx("p",{children:a.receiptData.transactionId})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Dispensed Date"}),e.jsx("p",{children:new Date(a.receiptData.dispensedAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Archived Date"}),e.jsx("p",{children:new Date(a.archivedAt).toLocaleString()})]})]})]}),a.prescriptionData.insuranceProvider&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Insurance Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Provider"}),e.jsx("p",{children:a.prescriptionData.insuranceProvider})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Coverage"}),e.jsxs("p",{children:[a.prescriptionData.insuranceCoveragePercentage,"%"]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Patient Copay"}),e.jsxs("p",{children:["$",a.prescriptionData.insuranceCopay]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"font-medium",children:"Total Cost"}),e.jsxs("p",{children:["$",((P=a.prescriptionData.totalCost)==null?void 0:P.toFixed(2))||"0.00"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(D,{variant:"outline",onClick:()=>b(!1),children:"Close"}),e.jsxs(D,{onClick:()=>T(a),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Print Receipt"]})]})]})]})})]})}export{oe as default};
