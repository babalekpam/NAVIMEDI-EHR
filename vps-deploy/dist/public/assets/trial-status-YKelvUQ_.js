import{bM as E,bN as R,at as O,au as v,aL as L,c as w,j as e,C as j,g as p,bO as l,am as g,bP as c,h as i,R as f,d as b,e as S,an as D,aj as M,s as A,bQ as U,bR as N,t as d,a1 as t}from"./index-DHAHNq0D.js";function F(){const{user:n}=E(),[q,y]=R(),o=O(),{data:a}=v({queryKey:["/api/tenant/current"],enabled:!!n});if(L.useEffect(()=>{a&&a.subscriptionStatus!=="trial"&&y("/dashboard")},[a,y]),a&&a.subscriptionStatus!=="trial")return null;const{data:s,isLoading:T,error:P}=v({queryKey:["/api/trial/status"],enabled:!!n&&(a==null?void 0:a.subscriptionStatus)==="trial"}),x=w({mutationFn:async({tenantId:m,days:h})=>{const r=await fetch(`/api/trial/${m}/extend`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({days:h})});if(!r.ok)throw new Error("Failed to extend trial");return r.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["/api/trial/status"]})}}),u=w({mutationFn:async({tenantId:m,subscriptionPlan:h})=>{const r=await fetch(`/api/trial/${m}/reactivate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({subscriptionPlan:h})});if(!r.ok)throw new Error("Failed to reactivate tenant");return r.json()},onSuccess:()=>{o.invalidateQueries({queryKey:["/api/trial/status"]})}});if(T)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trial Status"})}),e.jsx("div",{className:"grid gap-6",children:e.jsx(j,{children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})})})})]});if(P)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trial Status"})}),e.jsxs(l,{children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(c,{children:"Failed to load trial status. Please try again."})]})]});if(!s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trial Status"})}),e.jsxs(l,{children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(c,{children:"Trial information not available."})]})]});const C=()=>{if(s.isPlatformOwner||s.unlimitedAccess)return e.jsx(t,{variant:"default",className:"bg-purple-100 text-purple-800",children:"Platform Owner - Unlimited Access"});switch(s.subscriptionStatus){case"trial":return s.isTrialActive?e.jsx(t,{variant:"secondary",className:"bg-blue-100 text-blue-800",children:"Active Trial"}):e.jsx(t,{variant:"destructive",children:"Trial Expired"});case"active":return e.jsx(t,{variant:"default",className:"bg-green-100 text-green-800",children:"Active Subscription"});case"suspended":return e.jsx(t,{variant:"destructive",children:"Suspended"});case"cancelled":return e.jsx(t,{variant:"secondary",children:"Cancelled"});case"expired":return e.jsx(t,{variant:"destructive",children:"Expired"});default:return e.jsx(t,{variant:"secondary",children:"Unknown"})}},k=Math.max(0,Math.min(100,s.daysRemaining/14*100));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trial Status"}),e.jsxs(i,{variant:"outline",onClick:()=>o.invalidateQueries({queryKey:["/api/trial/status"]}),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Trial Information"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status"}),C()]}),s.isPlatformOwner||s.unlimitedAccess?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Access Level"}),e.jsx("span",{className:"font-semibold text-purple-600",children:"Unlimited"})]}),e.jsx("div",{className:"p-3 bg-purple-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-purple-800",children:[e.jsx("strong",{children:"Platform Owner Status"}),e.jsx("br",{}),"As the platform owner, ARGILETTE has unlimited access to all features with no expiration."]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Trial Progress"}),e.jsxs("span",{children:[s.daysRemaining," days remaining"]})]}),e.jsx(M,{value:k,className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Started: ",new Date(s.trialStartDate).toLocaleDateString()]}),e.jsxs("span",{children:["Ends: ",new Date(s.trialEndDate).toLocaleDateString()]})]})]}),s.subscriptionStatus==="suspended"&&e.jsxs(l,{children:[e.jsx(g,{className:"h-4 w-4"}),e.jsxs(c,{children:[e.jsx("strong",{children:"Account Suspended"}),e.jsx("br",{}),s.suspensionReason||"Trial period expired",s.suspendedAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Suspended on: ",new Date(s.suspendedAt).toLocaleString()]})]})]}),s.isTrialActive&&s.daysRemaining<=3&&e.jsxs(l,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(c,{children:[e.jsx("strong",{children:"Trial Ending Soon"}),e.jsx("br",{}),"Your trial expires in ",s.daysRemaining," days. Upgrade now to continue using the service."]})]})]})]}),e.jsxs(j,{children:[e.jsx(b,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Account Actions"]})}),e.jsxs(p,{className:"space-y-4",children:[s.isPlatformOwner||s.unlimitedAccess?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-purple-800",children:[e.jsx("strong",{children:"Platform Owner Privileges"}),e.jsx("br",{}),"You have full administrative access to the entire platform with no limitations or expiration dates."]})}),e.jsx(N,{href:"/tenant-management",children:e.jsxs(i,{className:"w-full",variant:"outline",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Manage Organizations"]})})]}):e.jsxs(e.Fragment,{children:[s.subscriptionStatus==="trial"&&!s.isTrialExpired&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Upgrade to a paid plan to continue using all features after your trial ends."}),e.jsx(N,{href:"/pricing",children:e.jsxs(i,{className:"w-full",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"View Pricing Plans"]})})]}),s.subscriptionStatus==="suspended"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Your account has been suspended. Upgrade to reactivate your account."}),e.jsx(N,{href:"/pricing",children:e.jsxs(i,{className:"w-full",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Upgrade Now"]})})]})]}),(n==null?void 0:n.role)==="super_admin"&&e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Admin Actions"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>x.mutate({tenantId:s.id,days:14}),disabled:x.isPending,className:"w-full",children:[x.isPending?e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(A,{className:"h-4 w-4 mr-2"}),"Extend Trial (14 days)"]}),s.subscriptionStatus==="suspended"&&e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>u.mutate({tenantId:s.id,subscriptionPlan:"professional"}),disabled:u.isPending,className:"w-full",children:[u.isPending?e.jsx(f,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(d,{className:"h-4 w-4 mr-2"}),"Reactivate Account"]})]})]})]})]})]})}export{F as default};
